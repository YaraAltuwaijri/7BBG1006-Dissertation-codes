#!/bin/bash

VCF_DIR="/scratch/prj/mmg_data/gwas_catalog/downloads/HarmonizingExampleGwas/ready_backup/liftover"

echo "Running liftover QC on all GRCh38 VCFs in: $VCF_DIR"

for file in "$VCF_DIR"/GCST*_buildGRCh38_ready_chr12_withLP\#.vcf.gz; do
  [ -e "$file" ] || continue
  echo -e "\nüìÑ File: $(basename "$file")"

  # 1. Record count
  count=$(bcftools view -H "$file" | wc -l)
  echo "‚úÖ Variant records: $count"

  # 2. Sample values (ES, SE, LP, AF)
  echo "üîç Sample data (first 2 variants):"
  bcftools query -f '%CHROM\t%POS\t[%ES\t%SE\t%LP\t%AF]\n' "$file" | head -n 2

  # 3. FORMAT header check
  echo "üîß FORMAT fields present:"
  zgrep "^##FORMAT" "$file" | grep -E "ID=ES|ID=SE|ID=LP|ID=AF"

  # 4. Missing value check
missing=$(bcftools query -f '[%ES\t%SE\t%LP\t%AF\n]' "$file" | grep -P '\t\.\b|\b\.\t|\t\.\t|\.\n' | wc -l)
  echo "‚ùó Missing ES/SE/LP/AF values in $missing variants"

done
